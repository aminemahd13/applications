# ============================================
# Event Platform Environment Variables
# ============================================
# INSTRUCTIONS: Copy this file to .env and adjust values for your environment.

# ============================================
# 1. DATABASE (PostgreSQL)
# ============================================
# Connection URL: postgresql://[user]:[password]@[host]:[port]/[database]?schema=public
# - Development (Docker): host=localhost, port=5432
# - Production (Docker Network): host=postgres (Service Name), port=5432. 
#   NOTE: We use the service name 'postgres' which resolves within the 'event_platform_net' network.
DATABASE_URL="postgresql://postgres:password@localhost:5432/events_platform?schema=public"

# Database credentials (used by Docker Compose to initialize DB)
POSTGRES_USER=postgres
POSTGRES_PASSWORD=password
POSTGRES_DB=events_platform

# ============================================
# 2. CACHE & QUEUE (Redis)
# ============================================
# Connection URL: redis://:[password]@[host]:[port]
# - Development: localhost
# - Production: redis (Service Name)
REDIS_PASSWORD="changeme_redis_password"
REDIS_URL="redis://:${REDIS_PASSWORD}@localhost:6379"

# ============================================
# 3. FILE STORAGE (MinIO / S3)
# ============================================
# Endpoint should include protocol (http/https). 
# - Development: http://localhost:9000
# - Production (Internal): http://minio:9000 (Service Name)
MINIO_ENDPOINT="http://localhost:9000"
MINIO_PORT=9000
MINIO_USE_SSL=false
MINIO_ROOT_USER=minioadmin
MINIO_ROOT_PASSWORD=minioadmin

# Bucket Names (Created automatically by init script in dev)
MINIO_BUCKET_NAME="uploads"
# Public assets bucket (optional if using direct serving)
MINIO_PUBLIC_BUCKET="public-assets"

# Credentials for API to access MinIO
# In dev, matches ROOT_USER/PASSWORD. In prod, use standard AWS_ACCESS_KEY_ID style if using real S3.
MINIO_ACCESS_KEY=minioadmin
MINIO_SECRET_KEY=minioadmin

# ============================================
# 4. API SERVER CONFIGURATION
# ============================================
NODE_ENV=production
# Internal port (default 3000 used by Dockerfile)
PORT=3000

# Security Secrets (Generate using `openssl rand -hex 32`)
JWT_SECRET="changeme-in-production-secure-jwt-secret-key-123"
SESSION_SECRET="changeme-in-production-secure-session-secret-key-456"

# CORS & Cookies (Set to your actual domain)
CORS_ORIGIN="https://apply.mathmaroc.org"
COOKIE_DOMAIN=".mathmaroc.org"
APP_BASE_URL="https://apply.mathmaroc.org"

# ============================================
# 5. FRONTEND CONFIGURATION (Next.js)
# ============================================
# Direct Public API URL (Browser -> API)
# Use a relative path if managing everything via Nginx/Next.js rewrites on the same domain
NEXT_PUBLIC_API_URL="/api/v1"

# Root Domain for Subdomain Routing (e.g., "mathmaroc.org")
NEXT_PUBLIC_ROOT_DOMAIN="apply.mathmaroc.org"

# Routing Mode ("path" | "subdomain")
# - path: http://localhost:3000/events/my-event
# - subdomain: http://my-event.localhost:3000
NEXT_PUBLIC_ROUTING_MODE="path"

# Asset Configuration
# Where browsers should fetch images from. if empty, proxies through Next.js/API.
# NEXT_PUBLIC_ASSET_HOST="https://assets.mathmaroc.org"
NEXT_PUBLIC_ASSET_HOST=""
NEXT_PUBLIC_DIRECT_ASSET_HOST=""

# ============================================
# 6. MAIL (SMTP)
# ============================================
# Production: AWS SES, SendGrid, etc.
SMTP_HOST="smtp.sendgrid.net"
SMTP_PORT=587
# Optional override. If unset, app uses SMTP_PORT===465 as secure=true.
SMTP_SECURE=false
SMTP_USER="apikey"
SMTP_PASS="your-sendgrid-api-key"
SMTP_FROM="noreply@mathmaroc.org"

# ============================================
# 7. PERFORMANCE & TUNING (Optional)
# ============================================
SESSION_REVOKE_SCAN_FALLBACK=false
SESSION_REVOKE_SCAN_MAX_KEYS=5000
AUDIT_QUEUE_MAX_SIZE=2000
AUDIT_MAX_RETRIES=2
AUDIT_EVENT_LOOKUP_CACHE_TTL_MS=120000
COMPOSE_BAKE=true
